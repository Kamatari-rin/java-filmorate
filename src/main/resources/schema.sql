DROP TABLE IF EXISTS FILMS CASCADE;
DROP TABLE IF EXISTS GENRE_FILM CASCADE;
DROP TABLE IF EXISTS GENRES CASCADE;
DROP TABLE IF EXISTS MPA_RATING CASCADE;
DROP TABLE IF EXISTS FILM_LIKE CASCADE;
DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS FRIENDS CASCADE;

CREATE TABLE IF NOT EXISTS GENRES (
	GENRE_ID INTEGER PRIMARY KEY,
	GENRE_NAME VARCHAR(30) NOT NULL
);

CREATE TABLE IF NOT EXISTS MPA_RATINGS (
	RATING_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	RATING_NAME VARCHAR(30) NOT NULL
);

CREATE TABLE IF NOT EXISTS PUBLIC.FILM_LIKE (
	USER_ID INTEGER NOT NULL,
	FILM_ID INTEGER NOT NULL
);

CREATE TABLE IF NOT EXISTS FRIENDS (
	USER_ID INTEGER NOT NULL,
	FRIEND_ID INTEGER NOT NULL
);

CREATE TABLE IF NOT EXISTS GENRE_FILM (
	GENRE_ID INTEGER NOT NULL,
	FILM_ID INTEGER NOT NULL
);

CREATE TABLE IF NOT EXISTS USERS (
	USER_LOGIN VARCHAR(50) NOT NULL,
	USER_NAME VARCHAR(50) NOT NULL,
	USER_BIRTHDAY TIMESTAMP,
	USER_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
	USER_EMAIL VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS FILMS (
	FILM_DESCRIPTION VARCHAR(200) NOT NULL,
	FILM_RELEASE_DATE TIMESTAMP NOT NULL,
	FILM_DURATION INTEGER NOT NULL,
	RATING_ID INTEGER,
	FILM_NAME VARCHAR(100) NOT NULL,
	FILM_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
);

ALTER TABLE FILMS ADD CONSTRAINT FILMS_FK FOREIGN KEY (RATING_ID) REFERENCES MPA_RATINGS(RATING_ID);


ALTER TABLE GENRE_FILM ADD CONSTRAINT FILM_GENRE_FK FOREIGN KEY (FILM_ID) REFERENCES FILMS(FILM_ID);
ALTER TABLE GENRE_FILM ADD CONSTRAINT FILM_GENRE_FK2 FOREIGN KEY (GENRE_ID) REFERENCES GENRES(GENRE_ID);


ALTER TABLE FRIENDS ADD CONSTRAINT FRIENDS_FK FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID);
ALTER TABLE FRIENDS ADD CONSTRAINT FRIENDS_FK2 FOREIGN KEY (FRIEND_ID) REFERENCES USERS(USER_ID);


ALTER TABLE FILM_LIKE ADD CONSTRAINT FILM_LIKES_FK FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID);
ALTER TABLE FILM_LIKE ADD CONSTRAINT FILM_LIKES_FK2 FOREIGN KEY (FILM_ID) REFERENCES FILMS(FILM_ID);


INSERT INTO MPA_RATINGS (RATING_ID, RATING_NAME)
VALUES (1, 'G'),
	 (2, 'PG'),
	 (3, 'PG-13'),
	 (4, 'R'),
	 (5, 'NC-17');

INSERT INTO GENRES (GENRE_ID, GENRE_NAME)
VALUES (1, 'Комедия'),
(2, 'Драма'),
(3, 'Мультфильм'),
(4, 'Триллер'),
(5, 'Документальный'),
(6, 'Боевик');